#!/bin/sh

# passmenu wrapper for Termux

if [ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]; then
	which pass >/dev/null || exit 1
	[ "$1" = "--type" ] && typeit="true"
	prefix=${PASSWORD_STORE_DIR:-$HOME/.password-store}
	for i in $(ls "$PASSWORD_STORE_DIR"); do
		password_files="${password_files#\\n}\n${i%.gpg}"
	done
	password=$(printf "${password_files}" | dmenu "$@")
	[ -z $password ] && exit
	if [ -z "$typeit" ]; then
		pass show -c "$password" 2>/dev/null
	else
		pass show "$password" \
			| { IFS= read -r pass; printf %s "$pass"; } \
			| xdotool type --clearmodifiers --file -
	fi
else
	"$PREFIX"/bin/passdmenu "$@"
fi
